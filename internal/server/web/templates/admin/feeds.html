{{ define "styles" }}
<link rel="stylesheet" href="{{ themeCSS .Data.Settings "feeds.css" }}">
{{ end }}

{{ define "content" }}
<div class="feeds-container">
<div class="panel add-feed">
        <h3>Add New Feed</h3>
        <form id="addFeedForm" class="feed-form">
            <input type="hidden" name="csrf_token" value="{{ .CSRFToken }}">
            <div class="input-group">
                <div class="input-wrapper">
                    <input type="url" 
                           id="feedUrl" 
                           class="feed-input"
                           placeholder="Enter RSS feed URL"
                           required
                           pattern="^https?://.+"
                           title="Please enter a valid URL starting with http:// or https://">
                    <div class="spinner"></div>
                </div>
                <button type="submit" id="submitButton" class="submit-button" disabled>Add Feed</button>
            </div>
            <div id="feedError" class="error-message"></div>
            <div id="feedPreview" class="feed-preview"></div>
        </form>
    </div>
    <div class="panel">
        <h3>Current Feeds</h3>
        <div class="table-container">
            <table>
                <caption class="sr-only">RSS feeds currently being monitored</caption>
                <thead>
                    <tr>
                        <th scope="col">Title</th>
                        <th scope="col">URL</th>
                        <th scope="col">Category</th>
                        <th scope="col">Tags</th>
                        <th scope="col">Last Fetched</th>
                        <th scope="col" class="action-column">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {{ range .Data.Feeds }}
                    <tr>
                        <td class="title-col" data-label="Title">{{ .Title }}</td>
                        <td class="url-column" data-label="URL">
                            <a href="{{ .URL }}" class="feed-url" target="_blank" rel="noopener noreferrer">{{ .URL }}</a>
                        </td>
                        <td class="category-column" data-label="Category">
                            {{ if .Category }}
                                <span class="category-tag">{{ .Category }}</span>
                            {{ else }}
                                <span class="empty-value">—</span>
                            {{ end }}
                        </td>
                        <td class="tags-column" data-label="Tags">
                            {{ if .Tags }}
                                <div class="tag-list">
                                    {{ range .Tags }}
                                        <span class="tag">{{ . }}</span>
                                    {{ end }}
                                </div>
                            {{ else }}
                                <span class="empty-value">—</span>
                            {{ end }}
                        </td>
                        <td class="date-column" data-label="Fetched">
                            {{ formatTimeInZone (index $.Data.Settings "timezone") .LastFetched }}
                        </td>
                        <td class="action-column" data-label="Actions">
                            <button class="edit-button" data-feed-id="{{ .ID }}">Edit</button>
                        </td>
                    </tr>
                    {{ end }}
                </tbody>
            </table>
        </div>
    </div>
</div>
<!-- Edit Feed Modal -->
<div id="editModal" class="modal">
    <div class="modal-content edit-modal-content">
        <h3>Edit Feed</h3>
        <form id="editFeedForm" class="edit-form">
            <input type="hidden" name="csrf_token" value="{{ .CSRFToken }}">
            <input type="hidden" id="editFeedId" name="feedId" value="">
            
            <div class="form-group">
                <label for="editTitle">Title</label>
                <input type="text" id="editTitle" name="title" required>
            </div>
            
            <div class="form-group">
                <label for="editUrl">URL</label>
                <input type="url" id="editUrl" name="url" required>
            </div>
            
            <div class="form-group">
                <label for="editCategory">Category</label>
                <div class="category-input-wrapper">
                    <input type="text" id="editCategory" name="category" autocomplete="off" placeholder="Enter category or select from existing ones">
                    <div id="categorySuggestions" class="category-suggestions"></div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="editTags">Tags</label>
                <div class="tag-input-container">
                    <div id="tagTokens" class="tag-tokens"></div>
                    
                    <div class="available-tags">
                        <div class="available-tags-label">Available tags (click to add):</div>
                        <div id="availableTagsList" class="available-tags-list"></div>
                    </div>
                    
                    <div class="new-tag-input">
                        <label class="new-tag-label">Add new tag:</label>
                        <input type="text" id="editTags" name="tags" autocomplete="off" placeholder="Type new tag name and press Enter">
                    </div>
                </div>
                <div class="tag-help">Click existing tags above to add them, or type new ones below</div>
            </div>
            
            <div class="modal-actions">
                <button type="submit" class="save-button">Save Changes</button>
                <button type="button" class="cancel-button" data-action="cancel-edit-feed">Cancel</button>
                <button type="button" class="delete-button modal-delete-button" id="deleteFromEdit">Delete Feed</button>
            </div>
            
            <div id="editError" class="error-message"></div>
        </form>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="modal">
    <div class="modal-content">
        <h3>Delete Feed</h3>
        <p id="deleteMessage"></p>
        <div class="modal-actions">
            <button id="confirmDelete" class="delete-button">Delete</button>
            <button class="modal-button cancel-delete" id="cancelDelete">Cancel</button>
        </div>
    </div>
</div>

{{ end }}

{{ define "scripts" }}
<script type="module" src="/static/js/modules/feeds-page-init.js"></script>
{{ end }}